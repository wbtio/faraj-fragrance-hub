# ✅ ميزة رفع الصور للمنتجات

## 🎯 ما تم إنجازه

تم إضافة ميزة **رفع الصور** في صفحة إدارة المنتجات!

الآن تقدر ترفع صورة المنتج من:
- 📱 **الموبايل** (التخزين النقال)
- 💻 **الكمبيوتر** (تخزين الجهاز)

---

## 🎨 كيف تعمل

### في نموذج إضافة/تعديل منتج:

```
┌─────────────────────────────────────┐
│ إضافة منتج جديد                     │
├─────────────────────────────────────┤
│ الاسم بالعربي *                     │
│ [________________]                  │
│                                     │
│ البراند *         الفئة *           │
│ [________]        [________]        │
│                                     │
│ السعر *           الكمية            │
│ [________]        [________]        │
│                                     │
│ صورة المنتج ✅ جديد!                │
│ [اختر ملف]                          │
│                                     │
│ ┌─────────────┐                     │
│ │   معاينة    │ ← الصورة تظهر هنا   │
│ │   الصورة    │                     │
│ └─────────────┘                     │
│                                     │
│ [إلغاء]  [إضافة]                   │
└─────────────────────────────────────┘
```

---

## 🔄 التدفق الكامل

### 1. المستخدم يختار صورة:
```
1. اضغط "اختر ملف"
   ↓
2. يفتح متصفح الملفات:
   - من الموبايل: الكاميرا أو المعرض
   - من الكمبيوتر: مستكشف الملفات
   ↓
3. اختر الصورة
   ↓
4. الصورة تظهر كمعاينة ✅
```

### 2. عند الحفظ:
```
1. اضغط "إضافة" أو "تحديث"
   ↓
2. النظام يرفع الصورة إلى Supabase Storage
   ↓
3. يحصل على رابط الصورة
   ↓
4. يحفظ الرابط في قاعدة البيانات
   ↓
5. الصورة تظهر في الموقع! ✅
```

---

## 💾 التخزين

### Supabase Storage:
- **Bucket:** `product-images`
- **المسار:** `products/[random-id]-[timestamp].jpg`
- **الوصول:** عام (public)

### مثال على رابط الصورة:
```
https://[project].supabase.co/storage/v1/object/public/product-images/products/abc123-1234567890.jpg
```

---

## 🎨 الميزات

### 1. ✅ معاينة الصورة
- تظهر الصورة فوراً بعد اختيارها
- قبل الحفظ
- حجم 128x128 بكسل

### 2. ✅ أنواع الملفات المدعومة
- JPG/JPEG
- PNG
- GIF
- WebP
- SVG

### 3. ✅ الصورة الحالية
- عند تعديل منتج موجود
- تظهر الصورة الحالية
- يمكن تغييرها

### 4. ✅ حالة الرفع
- يظهر "جاري الرفع..."
- الحقل يتعطل أثناء الرفع
- رسالة نجاح/فشل

---

## 📱 كيفية الاستخدام

### من الموبايل:

```
1. افتح /admin/products من الموبايل
2. اضغط "إضافة منتج جديد"
3. املأ البيانات
4. اضغط "اختر ملف" في حقل "صورة المنتج"
5. اختر:
   - 📷 "التقط صورة" (كاميرا)
   - 🖼️ "اختر من المعرض"
6. اختر/التقط الصورة
7. ستظهر معاينة الصورة ✅
8. اضغط "إضافة"
9. تم! الصورة رفعت ✅
```

### من الكمبيوتر:

```
1. افتح /admin/products
2. اضغط "إضافة منتج جديد"
3. املأ البيانات
4. اضغط "اختر ملف" في حقل "صورة المنتج"
5. يفتح مستكشف الملفات
6. اختر الصورة من جهازك
7. ستظهر معاينة الصورة ✅
8. اضغط "إضافة"
9. تم! الصورة رفعت ✅
```

---

## 🧪 اختبار

### السيناريو الكامل:

```
1. افتح: /admin/products

2. اضغط "إضافة منتج جديد"

3. املأ البيانات:
   - الاسم: "عطر ديور سوفاج"
   - البراند: "ديور"
   - الفئة: "رجالي"
   - السعر: 50000

4. اضغط "اختر ملف"

5. اختر صورة من جهازك

6. تحقق من:
   ✅ الصورة تظهر كمعاينة
   ✅ حجم 128x128

7. اضغط "إضافة"

8. انتظر...
   ✅ يظهر "جاري الرفع..."
   ✅ ثم "تم الإضافة بنجاح"

9. افتح /products

10. تحقق من:
    ✅ المنتج موجود
    ✅ الصورة تظهر
    ✅ الصورة واضحة

11. ارجع لـ /admin/products

12. اضغط "تعديل" على المنتج

13. تحقق من:
    ✅ الصورة الحالية تظهر
    ✅ يمكن تغييرها
```

---

## 🔧 الكود

### 1. State للصورة:
```typescript
const [imageFile, setImageFile] = useState<File | null>(null);
const [imagePreview, setImagePreview] = useState<string | null>(null);
const [isUploading, setIsUploading] = useState(false);
```

### 2. Function رفع الصورة:
```typescript
const uploadImage = async (file: File): Promise<string | null> => {
  const fileExt = file.name.split('.').pop();
  const fileName = `${Math.random()}-${Date.now()}.${fileExt}`;
  const filePath = `products/${fileName}`;

  const { error } = await supabase.storage
    .from('product-images')
    .upload(filePath, file);

  if (error) return null;

  const { data } = supabase.storage
    .from('product-images')
    .getPublicUrl(filePath);

  return data.publicUrl;
};
```

### 3. معالجة اختيار الصورة:
```typescript
const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (file) {
    setImageFile(file);
    const reader = new FileReader();
    reader.onloadend = () => {
      setImagePreview(reader.result as string);
    };
    reader.readAsDataURL(file);
  }
};
```

### 4. حقل رفع الصورة:
```jsx
<div className="space-y-2">
  <Label htmlFor="image">صورة المنتج</Label>
  <Input
    id="image"
    type="file"
    accept="image/*"
    onChange={handleImageChange}
    disabled={isUploading}
  />
  {imagePreview && (
    <img
      src={imagePreview}
      alt="معاينة"
      className="w-32 h-32 object-cover rounded-lg"
    />
  )}
</div>
```

---

## ⚠️ ملاحظات مهمة

### 1. إعداد Supabase Storage:

يجب إنشاء bucket في Supabase:

```
1. اذهب إلى Supabase Dashboard
2. Storage → Create Bucket
3. الاسم: "product-images"
4. Public: نعم ✅
5. احفظ
```

### 2. حجم الملف:

- الحد الأقصى: 5MB (افتراضي)
- يمكن تغييره من Supabase Dashboard

### 3. أنواع الملفات:

```html
accept="image/*"
```
يقبل جميع أنواع الصور.

---

## ✅ قائمة التحقق

### الكود:
- [x] State للصورة
- [x] Function رفع الصورة
- [x] Function معالجة الاختيار
- [x] حقل رفع في النموذج
- [x] معاينة الصورة
- [x] حالة الرفع

### الوظيفة:
- [x] اختيار صورة من الجهاز
- [x] معاينة قبل الرفع
- [x] رفع إلى Supabase
- [x] حفظ الرابط في قاعدة البيانات
- [x] عرض الصورة في الموقع

### التكامل:
- [x] يعمل مع إضافة منتج
- [x] يعمل مع تعديل منتج
- [x] الصورة تظهر في الموقع
- [x] يعمل على الموبايل والكمبيوتر

---

## 🎉 النتيجة النهائية

**✅ ميزة رفع الصور جاهزة!**

### الميزات:
1. ✅ رفع من الموبايل أو الكمبيوتر
2. ✅ معاينة فورية
3. ✅ تخزين في Supabase
4. ✅ عرض في الموقع
5. ✅ سهل الاستخدام

### الاستخدام:
- اختر ملف → معاينة → احفظ → تم! ✅

**جاهز للاستخدام! 🚀**
