# 🛒 تحديث السلة والصفحة الرئيسية

## ✅ ما تم إنجازه

### 1. 🛒 نظام سلة التسوق الكامل

#### قاعدة البيانات:
```sql
✅ جدول cart تم إنشاؤه في Supabase
- id (UUID)
- session_id (VARCHAR) - معرف الجلسة
- product_id (UUID) - المنتج
- quantity (INTEGER) - الكمية
- created_at, updated_at
- Indexes للأداء
- RLS Policies
```

#### الملفات المنشأة:

**1. `src/contexts/CartContext.tsx`**
- Context API لإدارة السلة
- الوظائف:
  - `addToCart()` - إضافة منتج
  - `removeFromCart()` - حذف منتج
  - `updateQuantity()` - تحديث الكمية
  - `clearCart()` - تفريغ السلة
  - `cartCount` - عدد المنتجات
  - `cartTotal` - المجموع الكلي
- **مرتبط بالكامل مع قاعدة البيانات**

**2. `src/pages/Cart.tsx`**
- صفحة سلة التسوق الكاملة
- الميزات:
  - ✅ عرض جميع المنتجات في السلة
  - ✅ زيادة/تقليل الكمية
  - ✅ حذف منتج
  - ✅ تفريغ السلة
  - ✅ ملخص الطلب
  - ✅ المجموع الكلي
  - ✅ زر "إتمام الطلب"
  - ✅ حالة فارغة جميلة
- **مرتبط بالكامل مع قاعدة البيانات**

**3. تحديث `src/App.tsx`**
- ✅ إضافة `CartProvider`
- ✅ إضافة route `/cart`

---

### 2. 🏠 تحسين الصفحة الرئيسية

#### `src/pages/IndexNew.tsx`
**الصفحة الرئيسية الجديدة المرتبطة بقاعدة البيانات:**

**الميزات:**
- ✅ تحميل البراندات من قاعدة البيانات
- ✅ عرض البراندات في carousel
- ✅ تحميل الأقسام من `homepage_sections`
- ✅ عرض المنتجات حسب الأقسام المحددة في لوحة التحكم
- ✅ كل قسم يعرض المنتجات المختارة له
- ✅ loading state جميل

**كيف يعمل:**
1. يحمل جميع البراندات النشطة
2. يحمل جميع الأقسام النشطة من `homepage_sections`
3. يحمل جميع المنتجات النشطة
4. يعرض البراندات في carousel
5. يعرض الأقسام بالترتيب المحدد
6. كل قسم يعرض المنتجات المختارة له (حتى 4 منتجات)

---

## 🎯 كيفية الاستخدام

### إدارة الصفحة الرئيسية:

#### 1. اذهب إلى لوحة التحكم
```
/admin/homepage
```

#### 2. أضف قسم جديد
- اضغط "إضافة قسم جديد"
- املأ:
  - **عنوان القسم**: مثال "أحدث عطور ديور"
  - **البراند**: اختر من القائمة
  - **ترتيب العرض**: 1, 2, 3...
  - **المنتجات**: اختر حتى 4 منتجات

#### 3. النتيجة
- القسم سيظهر في الصفحة الرئيسية
- بالترتيب المحدد
- مع المنتجات المختارة

---

### استخدام السلة:

#### 1. إضافة منتج للسلة
```javascript
import { useCart } from "@/contexts/CartContext";

const { addToCart } = useCart();

// في أي مكان في الكود
<Button onClick={() => addToCart(productId)}>
  أضف للسلة
</Button>
```

#### 2. عرض عدد المنتجات
```javascript
const { cartCount } = useCart();

<Badge>{cartCount}</Badge>
```

#### 3. الذهاب للسلة
```javascript
navigate("/cart");
```

---

## 📊 البيانات في قاعدة البيانات

### جدول cart:
```sql
SELECT 
  c.id,
  c.session_id,
  c.quantity,
  p.name_ar,
  p.price
FROM cart c
LEFT JOIN products p ON c.product_id = p.id;
```

### جدول homepage_sections:
```sql
SELECT 
  hs.title,
  b.name_ar as brand,
  hs.product_ids,
  hs.display_order
FROM homepage_sections hs
LEFT JOIN brands b ON hs.brand_id = b.id
WHERE hs.is_active = true
ORDER BY hs.display_order;
```

---

## 🔄 تدفق البيانات

### السلة:
```
1. المستخدم يضغط "أضف للسلة"
2. addToCart() يتم استدعاؤه
3. يتحقق إذا المنتج موجود في السلة
4. إذا موجود: يزيد الكمية
5. إذا غير موجود: يضيف سطر جديد
6. يحفظ في جدول cart
7. يحدث الواجهة تلقائياً
```

### الصفحة الرئيسية:
```
1. IndexNew يتم تحميله
2. fetchData() يتم استدعاؤه
3. يحمل البراندات من brands
4. يحمل الأقسام من homepage_sections
5. يحمل المنتجات من products
6. يعرض البراندات في carousel
7. يعرض الأقسام بالترتيب
8. كل قسم يعرض منتجاته
```

---

## 🎨 الواجهة

### صفحة السلة:
- **Header**: العنوان + عدد المنتجات + أزرار التنقل
- **قائمة المنتجات**: 
  - صورة المنتج
  - الاسم والسعر
  - أزرار الكمية (+/-)
  - زر الحذف
  - المجموع لكل منتج
- **ملخص الطلب**:
  - المجموع الفرعي
  - التوصيل (مجاني)
  - المجموع الكلي
  - زر "إتمام الطلب"
  - زر "متابعة التسوق"
  - معلومات إضافية
- **حالة فارغة**: رسالة + أيقونة + زر للمنتجات

### الصفحة الرئيسية:
- **Hero Section**: صورة كبيرة
- **Carousel البراندات**: جميع البراندات من قاعدة البيانات
- **الأقسام**: حسب الترتيب في homepage_sections
- **About Section**: قصة المتجر

---

## 🔗 الربط بين الصفحات

### من لوحة التحكم → الصفحة الرئيسية:
1. المدير يضيف قسم في `/admin/homepage`
2. يختار براند ومنتجات
3. يحفظ في قاعدة البيانات
4. المستخدم يفتح `/` (IndexNew)
5. القسم يظهر تلقائياً!

### من المنتجات → السلة:
1. المستخدم يتصفح المنتجات
2. يضغط "أضف للسلة"
3. يحفظ في قاعدة البيانات
4. يذهب إلى `/cart`
5. يرى منتجاته!

---

## 📝 ملاحظات مهمة

### السلة:
- ✅ تستخدم `session_id` لتتبع المستخدم
- ✅ الـ session_id يحفظ في localStorage
- ✅ السلة تبقى حتى بعد إغلاق المتصفح
- ✅ كل عملية مرتبطة بقاعدة البيانات

### الصفحة الرئيسية:
- ✅ البراندات تحمل من قاعدة البيانات
- ✅ الأقسام تحمل من homepage_sections
- ✅ المنتجات تحمل من products
- ✅ كل شيء ديناميكي ومرتبط بلوحة التحكم

---

## 🚀 الخطوات التالية

### لاستخدام الصفحة الرئيسية الجديدة:

#### الطريقة 1: استبدال Index القديم
```bash
# احذف Index.tsx القديم
rm src/pages/Index.tsx

# أعد تسمية IndexNew.tsx
mv src/pages/IndexNew.tsx src/pages/Index.tsx
```

#### الطريقة 2: تحديث App.tsx
```typescript
// في App.tsx
import Index from "./pages/IndexNew";  // بدلاً من Index
```

---

## 🧪 الاختبار

### اختبار السلة:

1. **إضافة منتج:**
```javascript
// في أي صفحة منتجات
import { useCart } from "@/contexts/CartContext";
const { addToCart } = useCart();

<Button onClick={() => addToCart("product-id-here")}>
  أضف للسلة
</Button>
```

2. **التحقق من قاعدة البيانات:**
```sql
SELECT * FROM cart;
```

3. **فتح صفحة السلة:**
```
http://localhost:5173/cart
```

### اختبار الصفحة الرئيسية:

1. **أضف أقسام في لوحة التحكم:**
```
/admin/homepage
```

2. **افتح الصفحة الرئيسية الجديدة:**
```
/  (إذا استبدلت Index)
أو
قم بتحديث App.tsx لاستخدام IndexNew
```

3. **تحقق من:**
- ✅ البراندات تظهر في carousel
- ✅ الأقسام تظهر بالترتيب
- ✅ المنتجات صحيحة

---

## 📊 الإحصائيات

### الملفات المنشأة:
```
✅ CartContext.tsx       - Context API للسلة
✅ Cart.tsx              - صفحة السلة
✅ IndexNew.tsx          - الصفحة الرئيسية الجديدة
✅ تحديث App.tsx        - إضافة routes
```

### قاعدة البيانات:
```
✅ جدول cart            - السلة
✅ جدول homepage_sections موجود مسبقاً
✅ RLS Policies
✅ Indexes
```

### الوظائف:
```
✅ إضافة للسلة
✅ حذف من السلة
✅ تحديث الكمية
✅ تفريغ السلة
✅ عرض الأقسام من قاعدة البيانات
✅ عرض البراندات من قاعدة البيانات
```

---

## 🎉 الخلاصة

**تم إنجاز كل ما طلبته:**

1. ✅ **سلة التسوق كاملة** مرتبطة بقاعدة البيانات
2. ✅ **الصفحة الرئيسية** تعرض الأقسام من لوحة التحكم
3. ✅ **إدارة البراندات** من لوحة التحكم تظهر في الصفحة الرئيسية
4. ✅ **إدارة الأقسام** من `/admin/homepage` تظهر في الصفحة الرئيسية
5. ✅ **كل شيء مرتبط بقاعدة البيانات**

**جاهز للاستخدام! 🚀**
